// Name : Radio_decl.h
//
// Author : nived.sivadas@samraksh.com
//
// Description : Contains the interfaces used by the pal layer
//
#ifndef _RADIO_DECL_H_
#define _RADIO_DECL_H_

#include <tinyhal.h>

typedef UINT8 ErrorType;

class CCA
{
public:
	// Request cca to the radio
	static ErrorType request();
};

// This structure defines an interface for radio events
struct IRadioEvents
{
	///////////////////////////////////////////////
	// Description : Called on an sfd event from the radio driver layer
	///////////////////////////////////////////////
	BOOL (*SFDEvent)(void *data);

	///////////////////////////////////////////////
	// Description : Called on an efd event from the radio driver layer
	///////////////////////////////////////////////
	BOOL (*EFDEvent)(void *data);

	///////////////////////////////////////////////
	// Description : Called on completion of cca
	//////////////////////////////////////////////
	BOOL (*ccaDoneEvent) (void *data);

	///////////////////////////////////////////////
	// Description : Called on completion of radio send
	//////////////////////////////////////////////
	BOOL (*radioSendDoneEvent)(void *data);

};

// Default handler
BOOL Default_Handler(void *data)
{
	return TRUE;
}

struct RadioEventHandler
{
public:
	IRadioEvents *m_RadioEvents;

	// Temporarily passing null to the event handlers
	BOOL SFDEvent(){
		if(this->m_RadioEvents->SFDEvent == NULL)
			return Default_Handler();

		return this->m_RadioEvents->SFDEvent(NULL);
	}

	BOOL EFDEvent(){
		if(this->m_RadioEvents->EFDEvent == NULL)
			return Default_Handler();

		return this->m_RadioEvents->EFDEvent(NULL);
	}

	BOOL CCADoneEvent(){
		if(this->m_RadioEvents->ccaDoneEvent == NULL)
			return Default_Handler();

		return this->m_RadioEvents->ccaDoneEvent(NULL);
	}

	BOOL RadioSendDoneEvent(){
		if(this->m_RadioEvents->radioSendDoneEvent == NULL)
			return Default_Handler();

		return this->m_RadioEvents->radioSendDoneEvent(NULL);
	}
};

extern "C"
{
void Radio_Initialize(IRadioEvents *irevents);
// This function is reponsible for adding event handlers that will be called by the driver layer
void Radio_AddEventHandlers(RadioEventHandler* rEventHandler, IRadioEvents *handlers)
{
	rEventHandler->m_RadioEvents = handlers;
}

BOOL Radio_LoadPacket(void *data);

BOOL Radio_SendPacket();
}

// Enables timestamping of radio packets, identical to the timestamping interface suggested by TEP132 in tinyos and closely follows
// their rf230 implementation
template<class T>
class TimeStampLayer
{


public:
	static BOOL isValid(T *msg)
	{
		return TRUE;
	}

	static UINT32 timestamp(T *msg)
	{
		return 0;
	}

	static void clear(T *msg)
	{

	}

	static void set(T *msg, UINT32 value)
	{

	}

	static void set(T *msg)
	{

	}

};


#endif
